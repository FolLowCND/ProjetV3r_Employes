@using ProjetV3R_Employe.Data.Models
@inject EmployeService EmployeService

@if (!string.IsNullOrEmpty(messageErreur))
{
    <p style="color: red;">@messageErreur</p>
}

<h3>Liste des Employés</h3>

<table class="table">
    <thead>
        <tr>
            <th>Email</th>
            <th>Rôle</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var employe in employes)
        {
            <tr>
                <td>@employe.Email</td>
                <td>@employe.Role</td>
                <td>
                    <button @onclick="() => OnModifierEmploye.InvokeAsync(employe)" class="btn btn-warning">Modifier</button>
                    <button @onclick="() => SupprimerEmploye(employe.Id)" class="btn btn-danger">Supprimer</button>
                </td>
            </tr>
<<<<<<< HEAD
        </thead>
        <tbody>
            @foreach (var employe in employes)
            {
                <tr>
                    <td>@employe.Email</td>
                    <td>@roles.FirstOrDefault(r => r.IdRole == employe.Role)?.NomRole</td>
                    <td>
                        <button @onclick="() => OnModifier.InvokeAsync(employe)" class="btn btn-primary">Modifier</button>
                        <button @onclick="() => OnSupprimer.InvokeAsync(employe)" class="btn btn-danger">Supprimer</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    [Parameter] public EventCallback<User> OnEmployeSelectionne { get; set; }
    [Parameter] public EventCallback<User> OnModifier{ get; set; }
    [Parameter] public EventCallback<User> OnSupprimer { get; set; }

    private List<User> employes = new List<User>();
    private List<Role> roles = new List<Role>();
    private string? messageErreur;


    protected override async Task OnInitializedAsync()
    {
=======
        }
    </tbody>
</table>

@code {
    [Parameter]
    public EventCallback<User> OnModifierEmploye { get; set; }

    private List<User> employes = new List<User>();
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        await ChargerEmployes();
    }

    public async Task RechargerAsync()
    {
        await ChargerEmployes();
    }

    private async Task ChargerEmployes()
    {
>>>>>>> parent of 3040664 (c kk mdr)
        try
        {
            employes = await EmployeService.ObtenirEmployesAsync();
        }
        catch (Exception ex)
        {
            messageErreur = $"Erreur lors du chargement des employés : {ex.Message}";
        }
    }

<<<<<<< HEAD
    public async Task RechargerAsync()
    {
        await ChargerEmployes();
    }

    public async Task ChargerEmployes()
    {
        try
        {
            employes = await EmployeService.ObtenirEmployesAsync();
        }
        catch (Exception ex)
        {
            messageErreur = "Une erreur est survenue lors du chargement des employés. Veuillez réessayer.";
            Console.Error.WriteLine($"Erreur dans CompListeEmploye - ChargerEmployes: {ex.Message}");
        }
    }

    private async Task ChargerRoles()
=======
    private async Task SupprimerEmploye(int id)
>>>>>>> parent of 3040664 (c kk mdr)
    {
        try
        {
            await EmployeService.SupprimerEmployeAsync(id);
            await ChargerEmployes(); // Rafraîchir la liste après suppression
        }
        catch (Exception ex)
        {
<<<<<<< HEAD
            messageErreur = "Une erreur est survenue lors du chargement des rôles. Veuillez réessayer.";
            Console.Error.WriteLine($"Erreur dans CompListeEmploye - ChargerRoles: {ex.Message}");
=======
            errorMessage = "Une erreur est survenue lors de la suppression de l'employé. Veuillez réessayer.";
            Console.Error.WriteLine($"Erreur dans CompListeEmploye - SupprimerEmploye: {ex.Message}");
>>>>>>> parent of 3040664 (c kk mdr)
        }
    }
}
